<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор дополнительных соглашений v2.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="new_style.css">
</head>
<body>
    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'old-design')">Старый дизайн</button>
        <button class="tab-button" onclick="openTab(event, 'new-design')">Новый дизайн</button>
    </div>

    <div id="old-design" class="tab-content active">
        <div class="generator-container">
            <h1>Agreement Generator v5.2</h1>
            <div class="input-column">
                <fieldset>
                    <legend><svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" /></svg>Общие данные</legend>
                    <div class="form-grid">
                        <div class="form-group"><label for="main-contract-number">Номер договора</label><input type="text" id="main-contract-number"></div>
                        <div class="form-group"><label for="main-contract-date">Дата договора</label><input type="date" id="main-contract-date"></div>
                    </div>
                    <div class="form-group"><label for="insurance-type">Вид страхования</label><input type="text" id="insurance-type" value="добровольного страхования автомобильного транспорта"></div>
                </fieldset>
                <fieldset>
                    <legend><svg viewBox="0 0 24 24"><path d="M12,3C7.03,3 3,7.03 3,12C3,16.97 7.03,21 12,21C16.97,21 21,16.97 21,12C21,7.03 16.97,3 12,3M16.22,17.5C14.67,16.27 12.91,15.5 11,15.5C9.09,15.5 7.33,16.27 5.78,17.5C4.6,16.24 3.89,14.68 3.54,13H11V11.5H3.11C3.04,11 3,10.5 3,10C3,9.5 3.04,9 3.11,8.5H11V7H3.54C3.89,5.32 4.6,3.76 5.78,2.5C7.33,3.73 9.09,4.5 11,4.5C12.91,4.5 14.67,3.73 16.22,2.5C17.4,3.76 18.11,5.32 18.46,7H11V8.5H18.89C18.96,9 19,9.5 19,10C19,10.5 18.96,11 18.89,11.5H11V13H18.46C18.11,14.68 17.4,16.24 16.22,17.5Z" /></svg>Тип и основание</g></legend>
                    <div class="form-group"><label data-tooltip="Выберите, будут ли в соглашении меняться суммы или только информация (например, список застрахованных).">Тип соглашения <span class="tooltip-icon"><svg viewBox="0 0 24 24"><path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" /></svg></span></label><div class="toggle-group"><input type="radio" id="mode-monetary" name="change-mode" value="monetary" checked><label for="mode-monetary">Изменение сумм</label><input type="radio" id="mode-info" name="change-mode" value="info"><label for="mode-info">Информационные</label></div></div>
                    <div class="form-grid"><div class="form-group"><label for="base-document">Основание</label><select id="base-document"><option value="письмо Страхователя">Письмо Страхователя</option><option value="заявление Страхователя">Заявление</option></select></div><div class="form-group"><label for="incoming-doc-number">Вх. номер</label><input type="text" id="incoming-doc-number"></div><div class="form-group"><label for="incoming-doc-date">Дата вх.</label><input type="date" id="incoming-doc-date"></div></div>
                </fieldset>
                <div id="monetary-changes-wrapper" class="details-section visible">
                    <fieldset>
                        <legend><svg viewBox="0 0 24 24"><path d="M5,6H23V4H5A2,2 0 0,0 3,6V18A2,2 0 0,0 5,20H21V18H5V6M21,8H9V12H21V8M19,14H9V16H19V14Z" /></svg>Расчет сумм и премий</legend>
                        <div class="form-group"><label data-tooltip="Если изменения оформляются отдельным приложением (например, новый список ТС), укажите его номер. Поле не обязательно для заполнения.">Приложение № <span class="tooltip-icon"><svg viewBox="0 0 24 24"><path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" /></svg></span></label><input type="text" id="appendix-number-monetary" placeholder="1"></div>
                        <div class="form-group"><label data-tooltip="Выберите, увеличиваются или уменьшаются суммы. Это повлияет на авторасчет.">Операция <span class="tooltip-icon"><svg viewBox="0 0 24 24"><path d="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z" /></svg></span></label><div class="toggle-group"><input type="radio" id="sum-decrease" name="sum-change-type" value="уменьшилась" class="calc-trigger" checked><label for="sum-decrease">Уменьшить</label><input type="radio" id="sum-increase" name="sum-change-type" value="увеличилась" class="calc-trigger"><label for="sum-increase">Увеличить</label></div></div>
                        <hr style="border-color: var(--border-color); width: 100%;">
                        <div class="form-group"><div class="toggle-group" style="justify-content: flex-end;"><input type="checkbox" id="sum-no-change" class="no-change-toggle" data-target="sum"><label for="sum-no-change">Без изменений</label></div><div class="form-grid sum-fields"><div class="form-group"><label data-tooltip="Введите текущую общую страховую сумму до изменений.">Текущая стр. сумма</label><input type="text" class="number-input calc-trigger" id="sum-initial"></div><div class="form-group"><label data-tooltip="Введите сумму, НА которую происходит изменение.">Сумма изменения (Дельта)</label><input type="text" class="number-input calc-trigger" id="sum-delta"></div><div class="form-group" style="grid-column: 1 / -1;"><label>Новая итоговая стр. сумма (авто)</label><input type="text" id="sum-total" readonly></div></div></div>
                        <hr style="border-color: var(--border-color); width: 100%;">
                        <div class="form-group"><div class="toggle-group" style="justify-content: flex-end;"><input type="checkbox" id="premium-no-change" class="no-change-toggle" data-target="premium"><label for="premium-no-change">Без изменений</label></div><div class="form-grid premium-fields"><div class="form-group"><label>Текущая премия</label><input type="text" class="number-input calc-trigger" id="premium-initial"></div><div class="form-group"><label>Изменение премии (Дельта)</label><input type="text" class="number-input calc-trigger" id="premium-delta"></div><div class="form-group" style="grid-column: 1 / -1;"><label>Новая итоговая премия (авто)</label><input type="text" id="premium-total" readonly></div><div class="form-group" style="grid-column: 1 / -1;"><label for="payment-due-date">Срок доплаты/возврата до:</label><input type="date" id="payment-due-date"></div></div></div>
                    </fieldset>
                </div>
                <div id="info-changes-wrapper" class="details-section">
                    <fieldset>
                        <legend><svg viewBox="0 0 24 24"><path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z" /></svg>Информационные правки</legend>
                        <div class="form-group"><label>Тип инфо-изменения</label><div class="toggle-group"><input type="radio" id="info-type-general" name="info-change-type" value="general" checked><label for="info-type-general">Общий текст</label><input type="radio" id="info-type-insured" name="info-change-type" value="insured"><label for="info-type-insured">Застрахованные</label></div></div>
                        <div id="info-general-details" class="details-section visible"><div class="form-group"><label for="info-general-text">Опишите изменения</label><textarea id="info-general-text" rows="4" placeholder="Например: Стороны договорились изменить порядок оплаты страховой премии..."></textarea></div></div>
                        <div id="info-insured-details" class="details-section">
                            <div><h4>Добавить в список:</h4><div id="add-list-container"></div><button class="cyber-button small" type="button" onclick="addPerson('add')">+ Добавить</button></div>
                            <div><h4>Исключить из списка:</h4><div id="exclude-list-container"></div><button class="cyber-button small" type="button" onclick="addPerson('exclude')">+ Исключить</button></div>
                        </div>
                    </fieldset>
                </div>
                <div style="display:flex; justify-content:center;"><button class="cyber-button" onclick="generateText()">Сгенерировать текст</button></div>
            </div>
            <div class="output-column">
                <fieldset id="result-fieldset">
                    <legend><svg viewBox="0 0 24 24"><path d="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,4A4,4 0 0,1 16,8C16,9.95 14.6,11.58 12.82,11.93L12.44,14.36L11.56,14.44L11.94,12.03C10.03,11.56 8.5,9.88 8.5,8A3.5,3.5 0 0,1 12,4.5M12,6.5A1.5,1.5 0 0,0 10.5,8A1.5,1.5 0 0,0 12,9.5A1.5,1.5 0 0,0 13.5,8A1.5,1.5 0 0,0 12,6.5Z" /></svg>Заключение</legend>
                    <textarea id="result-text" readonly placeholder="Здесь появится сгенерированный текст..."></textarea>
                </fieldset>
            </div>
        </div>
    </div>

    <div id="new-design" class="tab-content">
        <div class="k-container">
            <header class="k-header">
                <h1>Чат с ИИ-консультантом</h1>
                <p>Начните диалог, чтобы составить дополнительное соглашение. ИИ задаст уточняющие вопросы.</p>
            </header>
            <main class="k-main">
                <div class="k-card chat-card">
                    <div class="k-card-body" id="chat-history">
                        <!-- Chat messages will be dynamically inserted here -->
                        <div class="chat-message assistant">
                            <div class="chat-bubble">Здравствуйте! Я ваш юридический ИИ-консультант. Опишите, какие изменения вы хотите внести в договор, и мы вместе подготовим документ.</div>
                        </div>
                    </div>
                    <div class="k-card-footer">
                        <div class="chat-input-form">
                            <textarea id="chat-input" class="k-textarea" placeholder="Введите ваш запрос..." rows="2"></textarea>
                            <button type="button" class="k-button" id="send-chat-btn">Отправить</button>
                        </div>
                    </div>
                </div>

                <div class="k-card k-result-card">
                     <div class="k-card-header">
                        <h2>Итоговый документ</h2>
                    </div>
                    <div class="k-card-body">
                        <div id="final-document-output" class="k-result-area">
                            <p class="k-placeholder">Здесь появится финальный текст документа после вашего подтверждения в чате...</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

<script src="script.js"></script>
<script src="ai_handler.js"></script>
</body>
</html>
